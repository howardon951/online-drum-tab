(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{940:(e,r,t)=>{Promise.resolve().then(t.bind(t,5042)),Promise.resolve().then(t.bind(t,2488))},2488:(e,r,t)=>{"use strict";t.d(r,{N:()=>c,ToneTransportProvider:()=>o});var n=t(5155),s=t(2115),a=t(6758);let l=(0,s.createContext)(void 0),o=e=>{let{children:r}=e,t=(0,s.useMemo)(()=>(0,a.oD)(),[]);return(0,n.jsx)(l.Provider,{value:{transport:t},children:r})};function c(){let e=(0,s.useContext)(l);if(!e)throw Error("useTransport 必須在 ToneTransportProvider 內使用");return e.transport}},5042:(e,r,t)=>{"use strict";t.d(r,{DrumMachine:()=>h});var n=t(5155),s=t(2115);let a=[{id:"kick",name:"kick",sound:"./sounds/kick.wav"},{id:"snare",name:"snare",sound:"./sounds/snare.wav"},{id:"hihat",name:"hihat",sound:"./sounds/hiHat.wav"},{id:"tomLow",name:"tomLow",sound:"./sounds/snare.wav"},{id:"tomMid",name:"tomMid",sound:"./sounds/snare.wav"},{id:"crash",name:"crash",sound:"./sounds/snare.wav"}];var l=t(6758);async function o(){try{return"running"!==l._O.state&&await l._O.resume(),!0}catch(e){return console.error("Failed to start audio context:",e),!1}}var c=t(2488);function u(e){let{sequence:r,currentStep:t,onCellClick:s,onSoundPlay:l}=e;return(0,n.jsx)("div",{className:"w-full max-w-4xl overflow-x-auto p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:(0,n.jsx)("table",{className:"w-full border-collapse",children:(0,n.jsx)("tbody",{children:a.map(e=>(0,n.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[(0,n.jsx)("td",{className:"py-2 pr-4 w-24",children:(0,n.jsx)("button",{className:"w-full text-left font-medium hover:text-blue-500 transition-colors truncate",onClick:()=>l(e.id),children:e.name})}),Array(16).fill(0).map((a,l)=>{var o;return(0,n.jsx)("td",{className:"text-center p-1",children:(0,n.jsx)("button",{className:"w-10 h-10 rounded-md transition-all ".concat((null==(o=r[e.id])?void 0:o[l])?"bg-blue-500 scale-100":"bg-gray-200 dark:bg-gray-700 scale-90"," ").concat(t===l?"border-2 border-orange-500":""),onClick:()=>s(e.id,l)})},l)})]},e.id))})})})}function i(e){let{isPlaying:r,bpm:t,onPlayPause:s,onClear:a,onBpmChange:l}=e;return(0,n.jsxs)("div",{className:"mb-6 flex gap-4 items-center",children:[(0,n.jsx)("button",{onClick:s,className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full text-lg transition-colors",children:r?"暫停":"播放"}),(0,n.jsx)("button",{onClick:a,className:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full text-lg transition-colors",children:"清除"}),(0,n.jsxs)("div",{className:"flex items-center ml-4",children:[(0,n.jsx)("label",{htmlFor:"bpm",className:"mr-2 font-medium",children:"BPM:"}),(0,n.jsx)("input",{id:"bpm",type:"number",min:"60",max:"200",value:t,onChange:e=>l(Number(e.target.value)),className:"w-16 px-2 py-1 border rounded text-center"})]})]})}function d(){return(0,n.jsxs)("div",{className:"mt-8 text-center text-sm text-gray-500",children:[(0,n.jsx)("p",{children:"Drum Sequencer by Tone.js"}),(0,n.jsx)("p",{className:"mt-2",children:"Click the drum sound name to listen to the sound"})]})}function m(){return(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"載入中..."})}function h(){let{sequence:e,isPlaying:r,currentStep:t,bpm:h,isClient:x,handleCellClick:f,handlePlayPause:b,handleClear:p,handleSoundPlay:v,setBpm:y}=function(){let[e,r]=(0,s.useState)({}),[t,n]=(0,s.useState)(!1),[u,i]=(0,s.useState)(-1),[d,m]=(0,s.useState)(120),[h,x]=(0,s.useState)(!1),f=(0,s.useRef)(null),b=(0,s.useRef)(null),p=(0,s.useRef)({}),v=(0,c.N)();(0,s.useEffect)(()=>{x(!0);let e={};a.forEach(r=>{e[r.id]=Array(16).fill(!1)}),r(e)},[]),(0,s.useEffect)(()=>{p.current=e},[e]),(0,s.useEffect)(()=>{if(h)return(async()=>{let e={};a.forEach(r=>{e[r.id]=r.sound}),f.current=function(e){try{return new l.vz(e).toDestination()}catch(e){return console.error("Failed to create samples player:",e),null}}(e),b.current=new l.gd((e,r)=>{i(r),a.forEach(t=>{var n,s;(null==(n=p.current[t.id])?void 0:n[r])&&(null==(s=f.current)||s.player(t.id).start(e))})},Array.from({length:16},(e,r)=>r),"16n")})(),()=>{b.current&&b.current.dispose(),f.current&&f.current.dispose()}},[h]),(0,s.useEffect)(()=>{if(h)return t?(v.start(),b.current&&b.current.start(0)):(v.stop(),i(-1),b.current&&b.current.stop()),()=>{v&&v.stop()}},[t,h,v]),(0,s.useEffect)(()=>{h&&function(e){try{l.oK.bpm.value=e}catch(e){return console.error("Failed to set BPM:",e),!1}}(d)},[d,h]);let y=async()=>{h&&(await o(),n(!t))};return{sequence:e,isPlaying:t,currentStep:u,bpm:d,isClient:h,handleCellClick:(t,n)=>{let s={...e,[t]:[...e[t]]};s[t][n]=!s[t][n],r(s)},handlePlayPause:y,handleClear:()=>{let e={};a.forEach(r=>{e[r.id]=Array(16).fill(!1)}),r(e)},handleSoundPlay:e=>{h&&f.current&&f.current.player(e).start()},setBpm:m}}();return x?(0,n.jsxs)("div",{className:"min-h-screen flex flex-col items-center py-8 px-4",children:[(0,n.jsx)("h1",{className:"text-2xl md:text-4xl font-bold mb-8",children:"互動式鼓機音序器"}),(0,n.jsx)(i,{isPlaying:r,bpm:h,onPlayPause:b,onClear:p,onBpmChange:y}),(0,n.jsx)(u,{sequence:e,currentStep:t,onCellClick:f,onSoundPlay:v}),(0,n.jsx)(d,{})]}):(0,n.jsx)(m,{})}}},e=>{var r=r=>e(e.s=r);e.O(0,[758,441,684,358],()=>r(940)),_N_E=e.O()}]);