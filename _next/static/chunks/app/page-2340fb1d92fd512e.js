(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1578:(e,r,t)=>{Promise.resolve().then(t.bind(t,5042)),Promise.resolve().then(t.bind(t,2488))},2488:(e,r,t)=>{"use strict";t.d(r,{N:()=>c,ToneTransportProvider:()=>o});var n=t(5155),s=t(2115),a=t(6758);let l=(0,s.createContext)(void 0),o=e=>{let{children:r}=e,t=(0,s.useMemo)(()=>(0,a.oD)(),[]);return(0,n.jsx)(l.Provider,{value:{transport:t},children:r})};function c(){let e=(0,s.useContext)(l);if(!e)throw Error("useTransport 必須在 ToneTransportProvider 內使用");return e.transport}},5042:(e,r,t)=>{"use strict";t.d(r,{DrumMachine:()=>x});var n=t(5155),s=t(2115);let a=[{id:"kick",name:"kick",sound:"./sounds/kick.wav"},{id:"snare",name:"snare",sound:"./sounds/snare.wav"},{id:"hihat",name:"hihat",sound:"./sounds/hiHat.wav"},{id:"tomLow",name:"tomLow",sound:"./sounds/snare.wav"},{id:"tomMid",name:"tomMid",sound:"./sounds/snare.wav"},{id:"crash",name:"crash",sound:"./sounds/snare.wav"}];var l=t(6758);async function o(){try{return"running"!==l._O.state&&await l._O.resume(),!0}catch(e){return console.error("Failed to start audio context:",e),!1}}function c(e){try{return l.oK.bpm.value=e,!0}catch(e){return console.error("Failed to set BPM:",e),!1}}var i=t(2488);function u(e){let{sequence:r,currentStep:t,onCellClick:s,onSoundPlay:l}=e;return(0,n.jsx)("div",{className:"w-full max-w-4xl overflow-x-auto p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:(0,n.jsx)("table",{className:"w-full border-collapse",children:(0,n.jsx)("tbody",{children:a.map(e=>(0,n.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[(0,n.jsx)("td",{className:"py-2 pr-4 w-24",children:(0,n.jsx)("button",{className:"w-full text-left font-medium hover:text-blue-500 transition-colors truncate",onClick:()=>l(e.id),children:e.name})}),Array(16).fill(0).map((a,l)=>{var o;return(0,n.jsx)("td",{className:"text-center p-1",children:(0,n.jsx)("button",{className:"w-10 h-10 rounded-md transition-all ".concat((null==(o=r[e.id])?void 0:o[l])?"bg-blue-500 scale-100":"bg-gray-200 dark:bg-gray-700 scale-90"," ").concat(t===l?"border-2 border-orange-500":""),onClick:()=>s(e.id,l)})},l)})]},e.id))})})})}function d(e){let{isPlaying:r,bpm:t,onPlayPause:s,onClear:a,onBpmChange:l}=e;return(0,n.jsxs)("div",{className:"mb-6 flex gap-4 items-center",children:[(0,n.jsx)("button",{onClick:s,className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full text-lg transition-colors",children:r?"暫停":"播放"}),(0,n.jsx)("button",{onClick:a,className:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full text-lg transition-colors",children:"清除"}),(0,n.jsxs)("div",{className:"flex items-center ml-4",children:[(0,n.jsx)("label",{htmlFor:"bpm",className:"mr-2 font-medium",children:"BPM:"}),(0,n.jsx)("input",{id:"bpm",type:"number",min:"60",max:"200",value:t,onChange:e=>l(Number(e.target.value)),className:"w-16 px-2 py-1 border rounded text-center"})]})]})}function m(){return(0,n.jsxs)("div",{className:"mt-8 text-center text-sm text-gray-500",children:[(0,n.jsx)("p",{children:"Drum Sequencer by Tone.js"}),(0,n.jsx)("p",{className:"mt-2",children:"Click the drum sound name to listen to the sound"})]})}function h(){return(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"載入中..."})}function x(){let{sequence:e,isPlaying:r,currentStep:t,bpm:x,isClient:f,handleCellClick:b,handlePlayPause:p,handleClear:v,handleSoundPlay:y,setBpm:g}=function(){let[e,r]=(0,s.useState)({}),[t,n]=(0,s.useState)(!1),[u,d]=(0,s.useState)(-1),[m,h]=(0,s.useState)(120),[x,f]=(0,s.useState)(!1),b=(0,s.useRef)(null),p=(0,s.useRef)(null),v=(0,i.N)();(0,s.useEffect)(()=>{f(!0);let e={};a.forEach(r=>{e[r.id]=Array(16).fill(!1)}),r(e)},[]),(0,s.useEffect)(()=>{if(x)return(async()=>{let r={};a.forEach(e=>{r[e.id]=e.sound}),b.current=function(e){try{return new l.vz(e).toDestination()}catch(e){return console.error("Failed to create samples player:",e),null}}(r),c(m),p.current=new l.gd((r,t)=>{d(t),a.forEach(n=>{if(e[n.id]&&e[n.id][t]){var s;null==(s=b.current)||s.player(n.id).start(r)}})},Array.from({length:16},(e,r)=>r),"16n")})(),()=>{p.current&&p.current.dispose(),b.current&&b.current.dispose()}},[e,m,x]),(0,s.useEffect)(()=>{if(x)return t?(v.start(),p.current&&p.current.start(0)):(v.stop(),d(-1),p.current&&p.current.stop()),()=>{v&&v.stop()}},[t,x,v]),(0,s.useEffect)(()=>{x&&c(m)},[m,x]);let y=async()=>{x&&(await o(),n(!t))};return{sequence:e,isPlaying:t,currentStep:u,bpm:m,isClient:x,handleCellClick:(t,n)=>{let s={...e};s[t][n]=!s[t][n],r(s)},handlePlayPause:y,handleClear:()=>{let e={};a.forEach(r=>{e[r.id]=Array(16).fill(!1)}),r(e)},handleSoundPlay:e=>{x&&b.current&&b.current.player(e).start()},setBpm:h}}();return f?(0,n.jsxs)("div",{className:"min-h-screen flex flex-col items-center py-8 px-4",children:[(0,n.jsx)("h1",{className:"text-2xl md:text-4xl font-bold mb-8",children:"互動式鼓機音序器"}),(0,n.jsx)(d,{isPlaying:r,bpm:x,onPlayPause:p,onClear:v,onBpmChange:g}),(0,n.jsx)(u,{sequence:e,currentStep:t,onCellClick:b,onSoundPlay:y}),(0,n.jsx)(m,{})]}):(0,n.jsx)(h,{})}}},e=>{var r=r=>e(e.s=r);e.O(0,[758,441,684,358],()=>r(1578)),_N_E=e.O()}]);